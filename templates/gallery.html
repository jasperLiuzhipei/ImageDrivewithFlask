{% extends 'layout.html' %}
{% block title %}图库 - WebImageDrive{% endblock %}
{% block content %}
<h1 class="h4">图片图库</h1>
<form class="row gy-2 gx-2 align-items-center mb-3" method="get">
  <div class="col-auto">
    <input type="text" class="form-control" name="q" placeholder="搜索文件名" value="{{ q or '' }}">
  </div>
  <div class="col-auto">
    <input type="text" class="form-control" name="category" placeholder="类别" value="{{ category or '' }}">
  </div>
  <div class="col-auto">
    <button class="btn btn-primary" type="submit">筛选</button>
  </div>
</form>

{% if images|length == 0 %}
  <p class="text-muted">暂无图片。</p>
{% else %}
  <div class="row row-cols-2 row-cols-md-4 g-3">
    {% for img in images %}
      <div class="col">
        <div class="card h-100">
          <div class="card-body">
            <h6 class="card-title text-truncate" title="{{ img.filename }}">{{ img.filename }}</h6>
            <p class="card-subtitle mb-2 text-muted small">ID {{ img.id }}{% if img.category %} · {{ img.category }}{% endif %}</p>
            <a href="{{ url_for('web.image_detail', image_id=img.id) }}" class="stretched-link">详情</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  <nav class="mt-3">
    <ul class="pagination pagination-sm">
      {% set total_pages = (total // page_size) + (1 if total % page_size else 0) %}
      {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}"><a class="page-link" href="?page={{ p }}&page_size={{ page_size }}&q={{ q or '' }}&category={{ category or '' }}">{{ p }}</a></li>
      {% endfor %}
    </ul>
  </nav>
{% endif %}
{% endblock %}
